---
layout: post
title:  "Linux tc"
date:   2015-03-23 18:08:57
categories: openstack
---
# Linux tc 性能测试报告 #
	
## 目的 ##

测试使用Linux tc限速后是否会耗费很多系统资源，同时测试限速后是否会影响转发效率。

## 测试环境 ##

1. 10.216.25.63: tc规则所在集群，对数据进行限速转发。转发从62到54的数据包。
2. 10.216.25.62： 链接发起端。
3. 10.216.25.54： 链接接收端。

## 使用的测试软件 ##

在62和54上都安装有apache2,在62上使用Apache2自带的ab测试54的负载。

## 测试结果 ##

### 环境：63上没有使用tc创建队列，63只是单纯抓发数据包。###

**命令**： ab -c 2000 -n 40000 http://10.10.10.4/index.html

(命令解释：-c表示同时发起多少个链接，-n 表示总共处理多少个请求)

**结果**：(多次)requests per second : 12668.86, 7869.96,5619.73

###环境： eth1上没有tc规则, eth1上进来的数据镜像到ifb1，但是ifb1上没有创建tc规则。###

**命令**： ab -c 2000 -n 40000 http://10.10.10.4/index.html

**结果**：requests per second: 12193.29

###环境： eth1上没有tc规则，ifb1上创建htb队列，同时创建了class和filter，对来自10.10.10.4的数据包限速10000mbit(之所以设置这个大是想要得到没有限速的效果，这样就可以更好的跟没有限速进行对比)###

**命令**： ab -c 2000 -n 40000 http://10.10.10.4/index.html

**结果**：requests per second: 11535.11, 12207.88, 9063.36

###环境： eth1上没有tc规则， ifb1上将来自10.10.10.4的速度限制为12mbit.###

**命令**：ab -c 2000 -n 40000 http://10.10.10.4/index.html

**结果**：requests per second: 938.22

**命令**：ab -c 1000 -n 2000 http://10.10.10.4/index.html

**结果**：requests per second: 946.22， 562.36

###环境： eth1上有tc规则，ifb1上将来自10.10.10.4的速度限制为12mbit.###

**命令**： ab -c 2000 -n 4000 http://10.10.10.4/index.html

**结果**：requests per second: 562.25, 1551.75， 430.22

## 结论 ##
1. 在实验过程中，使用top观察63 cpu使用率等参数，tc数据包处理过程中和没有处理的时候是一样的，没有观察到任何变化，所以tc命令一秒最高处理一万二左右的连接对系统影响很小。（一万二已经是我测试过程中一秒处理连接的最高值，尝试很多次，还是没有办法处理更多连接）
1. 有无tc规则对处理连接的差别很小， 测试结果中有些数据相差比较大是网络不稳定，在极限速度下，我没有看出有tc规则和没有的区别。
1. 速度限制在12mbit是每秒处理包的数量明显减少是因为网速限制了ab下载网页导致的，我觉得跟有tc规则没有关系。


以上测试方法比较简单，肯定有很多不足，但是我找不到更好的测试办法，希望大家看后可以指点一下，O(∩_∩)O哈哈~